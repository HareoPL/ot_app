{
    "version": "2.0.0",
    "tasks": [
        {   "label": "project build",
            "type": "process",
            "command": "powershell.exe",
            "args": [
                "-ExecutionPolicy",
                "Bypass",
                // "-NoExit",
                "-Command",
                "& { . ${config:idfTask.cfgCMD.path} -IdfId ${config:idfTask.cfgCMD.IdfId}; idf.py build ${config:idfTask.OTDEVICE}; idf.py size}"
            ],
            "presentation": {
                "echo": true,
                "focus": true,
                "panel": "new"
            },
            "problemMatcher": [],
            "group": {
                "kind": "build",
                // "isDefault": true
            },

        },
        {   "label": "project flash",
            "type": "process",
            "command": "powershell.exe",
            "args": [
                "-ExecutionPolicy",
                "Bypass",
                // "-NoExit",
                "-Command",
                "& { . ${config:idfTask.cfgCMD.path} -IdfId ${config:idfTask.cfgCMD.IdfId}; esptool.py --chip ${config:idf.customExtraVars.IDF_TARGET} --port ${config:idf.portWin} --baud ${config:idfTask.flash.baud} --before=${config:idfTask.flash.before} --after=${config:idfTask.flash.after} --flash_mode ${config:idfTask.flash.mode} --flash_freq ${config:idfTask.flash.freq} --flash_size ${config:idfTask.flash.size} ${config:idfTask.flash.bootloader.adr} ${config:idfTask.flash.bootloader.path} ${config:idfTask.flash.app.adr} ${config:idfTask.flash.app.path} ${config:idfTask.flash.partitionTable.adr} ${config:idfTask.flash.partitionTable.path} ${config:idfTask.flash.otaDataInit.adr} ${config:idfTask.flash.otaDataInit.path}}"
            ],
            "presentation": {
                "echo": true,
                "focus": true,
                "panel": "new"
            },
            "problemMatcher": [],
            "group": {
                "kind": "build",
                "isDefault": false
            },
        },
        {
            "label": "project build & flash",
            "dependsOrder": "sequence",
            "dependsOn": [
                "project build",
                "project flash"
            ],
            "group": {
                "kind": "build"
            }
        },
        {   
            "label": "project reBuild",
            "type": "process",
            "command": "powershell.exe",
            "args": [
                "-ExecutionPolicy",
                "Bypass",
                // "-NoExit",
                "-Command",
                "& { . ${config:idfTask.cfgCMD.path} -IdfId ${config:idfTask.cfgCMD.IdfId}; idf.py clean; idf.py build; idf.py size}"
            ],
            "presentation": {
                "echo": true,
                "focus": true,
                "panel": "new"
            },
            "problemMatcher": [],
            "group": {
                "kind": "build",
                "isDefault": false
            },
        },
        {   
            "label": "spiffs reBuild & flash",
            "type": "process",
            "command": "powershell.exe",
            "args": [
                "-ExecutionPolicy",
                "Bypass",
                // "-NoExit",
                "-Command",
                "& { . ${config:idfTask.cfgCMD.path} -IdfId ${config:idfTask.cfgCMD.IdfId}; mkdir build/spiffs; Remove-Item 'build/spiffs' -Recurse -Force -Confirm:$false; mkdir build/spiffs; python spiffsgen.py ${config:idfTask.build.spiffs.binSize} ${config:idfTask.build.spiffs.outPath} --page-size ${config:idfTask.build.spiffs.pageSize} --block-size ${config:idfTask.build.spiffs.blockSize} --obj-name-len ${config:idfTask.build.spiffs.objNameLen} --meta-len ${config:idfTask.build.spiffs.metaLen}; esptool.py --chip ${config:idf.customExtraVars.IDF_TARGET} --port ${config:idf.portWin} --baud ${config:idfTask.flash.baud} --before=${config:idfTask.flash.before} --after=${config:idfTask.flash.after} --flash_mode ${config:idfTask.flash.mode} --flash_freq ${config:idfTask.flash.freq} --flash_size ${config:idfTask.flash.size} --compress ${config:idfTask.flash.spiffs.adr} ${config:idfTask.flash.spiffs.path}}"
            ],
            "presentation": {
                "echo": true,
                "focus": true,
                "panel": "new"
            },
            "problemMatcher": [],
            "group": {
                "kind": "build",
                "isDefault": false
            },
        },
        {   
            "label": "terminal IDF",
            "type": "process",
            "command": "powershell.exe",
            "args": [
                "-ExecutionPolicy",
                "Bypass",
                "-NoExit",
                "-Command",
                "& { . ${config:idfTask.cfgCMD.path} -IdfId ${config:idfTask.cfgCMD.IdfId}; }"
            ],
            "presentation": {
                "echo": true,
                "focus": true,
                "panel": "new"
            },
            "problemMatcher": [],
            "group": {
                "kind": "build",
                "isDefault": false
            },
        },
        //
        //
        // FOR TESTING 
        //
        // 
         {
            "label": "test Build",
            "type": "shell",
            "command": "ninja -v",
            "args": [],
            "options": {
                "cwd": "${workspaceFolder}/build/unit_test"
            },
            "group": {
                "kind": "build",
                // "isDefault": true
            },
            "problemMatcher": []
        },
        {
            "label": "test clean",
            "type": "shell",
            "command": "ninja -v clean",
            "args": [],
            "options": {
                "cwd": "${workspaceFolder}/build/unit_test"
            },
            "group": {
                "kind": "build",
                // "isDefault": true
            }
        },
        {
            "label": "rerun test",
            "dependsOrder": "sequence",
            "dependsOn": [
                "test clean",
                "test Build",
                "test run"
            ],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": []
        },
        {
            "label": "test run",
            "type": "shell",
            "command": "cd build/unit_test && ctest --output-on-failure -V",
            "args": [],
            // "options": {
            //     "cwd": "${workspaceFolder}/build/"
            // },
            "group": "test"
        },
        {
            "label": "test Rebuild Cmake, run test",
            "dependsOrder": "sequence",
            "dependsOn": [
                "CMake Rebuild config of unit_test",
                "test Build",
                "test run"
            ],
            "group": {
                "kind": "build",
                // "isDefault": true
            },
            "problemMatcher": []
        },
        {
            "label": "CMake update config of unit_test",
            "type": "shell",
            // "command": "cmake -DCMAKE_BUILD_TYPE:STRING=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS:BOOL=TRUE --no-warn-unused-cli -S./tests/unit_test -B./build/unit_test -G Ninja",
            "command": "cmake -DCMAKE_BUILD_TYPE:STRING=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS:BOOL=TRUE --no-warn-unused-cli -S./tests/unit_test -B./build/unit_test -G Ninja",
            "group": {
                "kind": "build"
            },
            "problemMatcher": {
                "base": "$gcc"
            }
        }, 
         {
            "label": "CMake Rebuild config of unit_test",
            "dependsOrder": "sequence",
            "dependsOn": [
                "CMake delete build unit_test",
                "CMake update config of unit_test"
            ],
            "group": {
                "kind": "test"
            }
        },
        {
            "label": "CMake delete build unit_test",
            "type": "shell",
            "command": "rm -rf build/unit_test",
            "group": {
                "kind": "build"
            }
        },                           
    ]
}
